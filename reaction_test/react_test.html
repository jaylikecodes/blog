<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>오! 지석이보다 빨르다고?</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="language-selector">
    <button class="lang-btn" data-lang="en">English</button>
    <button class="lang-btn" data-lang="ko">한국어</button>
  </div>
  
  
  <div class="game-container">
    <div class="game-area">
      <h1><span id="game-title">Oh!</span> <span data-text="title">can you faster than Jay?</span></h1>
      
      <!-- 게임 화면 영역 -->
      <div id="game-container">
        <div id="game-screen">
          <div id="signal-box" class="clickable-start" data-text="click-to-start">화면을 클릭하여 시작하세요</div>
        </div>
        
        <div class="records-container">
          <!-- 좌측 결과 및 기록 영역 -->
          <div id="results">
            <h3 data-text="result-title">테스트 결과</h3>
            <div id="results-content"></div>
          </div>
          
          <!-- 우측 반응 속도 측정 기록 -->
          <div id="reaction-records" class="reaction-records">
            <h3 data-text="records-title">기록</h3>
            <div id="records-list"></div>
          </div>
        </div>
      </div>
      
      <!-- 접이식 게임 설명 영역 -->
      <div class="how-to-play-container">
        <button class="collapsible" id="how-to-play-btn">
          <span data-text="how-to-play">How to play</span> <span class="toggle-icon">+</span>
        </button>
        <div class="collapsible-content" id="instructions">
          <p data-text="game-description">반응 속도를 테스트하는 간단한 게임입니다:</p>
          <ol>
            <li data-text="instruction-1">시작하기 버튼을 누르세요</li>
            <li data-text="instruction-2">화면이 녹색으로 바뀔 때까지 기다리세요</li>
            <li data-text="instruction-3">녹색으로 바뀌는 즉시 화면을 클릭하세요</li>
            <li data-text="instruction-4">5회 반복 후 최고 반응 시간이 기록됩니다</li>
          </ol>
          <p class="warning" data-text="warning">주의: 녹색으로 바뀌기 전에 클릭하면 안 됩니다!</p>
        </div>
      </div>
    </div>
    
    <div class="leaderboard-panel">
      <h2 data-text="leaderboard-title">순위표</h2>
      <div id="leaderboard-loading" class="hidden" data-text="loading">로딩 중...</div>
      
      <!-- 최고 기록 순위표 - 상시 노출 -->
      <div id="leaderboard-content">
        <table id="leaderboard-table">
          <thead>
            <tr>
              <th data-text="rank">순위</th>
              <th data-text="name">이름</th>
              <th data-text="score">반응속도</th>
              <th data-text="date">날짜</th>
            </tr>
          </thead>
          <tbody id="leaderboard-body">
            <!-- 최고 순위 데이터가 여기에 들어갑니다 -->
          </tbody>
        </table>
      </div>
      
      <div class="show-more-container">
        <button id="show-more-btn" class="show-more-btn" data-text="show-more">더 보기</button>
      </div>
    </div>
  </div>
  
  <!-- Firebase 및 애플리케이션 스크립트 로드 -->
  <!-- 1. Firebase 기본 스크립트 -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  
  <!-- 2. 핵심 틀 및 라이브러리 (처음에 로드) -->
  <script src="js/translations.js"></script>
  <script src="js/firebase-keys.js"></script>
  <script src="js/firebase-config.js"></script>
  
  <!-- 3. 애플리케이션 스크립트 -->
  <script src="js/audio.js"></script>
  <script src="js/leaderboard.js"></script>
  <script src="js/game.js"></script>
  <script src="js/ui.js"></script>
  
  <!-- 4. 초기화 스크립트(가장 마지막에 로드) -->
  <script src="js/main.js"></script>
  
  <!-- 5. 게임 로드 확인 스크립트 -->
  <script>
    // 페이지 로드 완료 후 실행
    window.addEventListener('load', function() {
      console.log('페이지 완전히 로드됨');
      
      // 이미 생성된 시작 버튼 제거 (HTML에서 추가된 버튼)
      setTimeout(function() {
        const manualStartButton = document.getElementById('manual-start-button');
        if (manualStartButton) {
          console.log('시작 버튼 제거 중...', manualStartButton.id);
          manualStartButton.remove();
        }
        
        // signal-box가 클릭 가능한지 확인
        const gameScreen = document.getElementById('signal-box');
        if (gameScreen && !gameScreen.classList.contains('clickable-start')) {
          gameScreen.className = '';
          gameScreen.classList.add('clickable-start');
          console.log('게임 화면 클릭 가능 상태로 설정');
        }
      }, 1000);
    });
  </script>
  <!-- 추가 언어 관련 스크립트 (ES 모듈 대신 일반 스크립트로 변경) -->
  <script>
    // 이미 위에서 translations.js를 로드하였으며 전역변수로 사용 가능
    
    // URL에서 언어 가져오기
    function getLanguageFromURL() {
      const urlParams = new URLSearchParams(window.location.search);
      const langParam = urlParams.get('lang');
      return langParam && (langParam === 'en' || langParam === 'ko') ? langParam : 'ko'; // 기본값은 한국어
    }

    // 언어 초기화
    function initializeLanguage() {
      const lang = getLanguageFromURL();
      document.documentElement.lang = lang;
      
      // Create global translation object for other modules to use
      window.gameTranslations = {
        translations: translations,
        currentLang: lang,
        
        // Get text for current language
        getText: function(key) {
          return this.translations[this.currentLang][key] || key;
        },
        
        // Change language
        changeLanguage: function(lang) {
          this.currentLang = lang;
          document.documentElement.lang = lang;
          
          // Sync with parent if in iframe
          if (window.parent && window.parent !== window) {
            try {
              if (window.parent.changeLanguage) {
                window.parent.changeLanguage(lang);
              }
            } catch (e) {
              console.log('Could not sync language with parent window', e);
            }
          }
        },
        
        // Update all text content
        updateAllText: function() {
          document.querySelectorAll('[data-text]').forEach(element => {
            const textKey = element.getAttribute('data-text');
            if (this.translations[this.currentLang] && this.translations[this.currentLang][textKey]) {
              element.textContent = this.translations[this.currentLang][textKey];
            }
          });
          
          // Update language button states
          document.querySelectorAll('.lang-btn').forEach(btn => {
            if (btn.getAttribute('data-lang') === this.currentLang) {
              btn.classList.add('active');
            } else {
              btn.classList.remove('active');
            }
          });
        }
      };
      
      // Update all text content for initial rendering
      window.gameTranslations.updateAllText();
      
      // Set up language buttons
      document.querySelectorAll('.lang-btn').forEach(button => {
        button.addEventListener('click', function() {
          const lang = this.getAttribute('data-lang');
          window.gameTranslations.changeLanguage(lang);
          window.gameTranslations.updateAllText();
          localStorage.setItem('selected_language', lang);
        });
      });
    }
    
    // Initialize when DOM is loaded
    document.addEventListener('DOMContentLoaded', function() {
      initializeLanguage();
    });
    
    // Call initialize immediately if document already loaded
    if (document.readyState === 'complete' || document.readyState === 'interactive') {
      initializeLanguage();
    }
  </script>
</body>
</html>